<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Xdest{% endblock %}</title>
    
    <!-- Theme initialization (prevents flash) -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.classList.add(theme);
        })();
    </script>
    
    <!-- Open Graph / Twitter Meta Tags -->
    {% block meta_tags %}
    <meta property="og:type" content="website">
    <meta property="og:title" content="Xdest - Developer Collaboration Hub">
    <meta property="og:description" content="The platform for developers to showcase projects, share updates, and connect with the collective.">
    <meta name="twitter:card" content="summary_large_image">
    {% endblock %}
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon.png">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" sizes="192x192" href="/static/favicon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/static/favicon-512.png">
    <meta name="theme-color" content="#0a0a14" id="theme-color-meta">
    
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            100: '#1a1a2e',
                            200: '#16213e',
                            300: '#0f0f23',
                            400: '#0a0a14',
                        },
                        light: {
                            100: '#ffffff',
                            200: '#f8fafc',
                            300: '#f1f5f9',
                            400: '#e2e8f0',
                        },
                        sand: {
                            100: '#faf6f1',
                            200: '#f5ebe0',
                            300: '#eddfcc',
                            400: '#e3d5c3',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Scroll offset for anchor links (accounts for fixed header) */
        [id^="post-"], #updates {
            scroll-margin-top: 100px;
        }
        
        /* Highlight animation for targeted posts */
        [id^="post-"]:target {
            animation: highlight-post 2s ease-out;
        }
        
        @keyframes highlight-post {
            0% { box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.6); }
            100% { box-shadow: none; }
        }
        
        /* Dark Mode (default) */
        .dark body {
            background-color: #0a0a14;
            color: #f3f4f6;
        }
        
        /* Light Mode */
        .light body {
            background-color: #ffffff;
            color: #1f2937;
        }
        .light .bg-dark-100 { background-color: #ffffff; }
        .light .bg-dark-200 { background-color: #fafafa; }
        .light .bg-dark-300 { background-color: #f5f5f5; }
        .light .bg-dark-400 { background-color: #f0f0f0; }
        .light .bg-dark-400\/80 { background-color: rgba(240, 240, 240, 0.8); }
        .light .hover\:bg-dark-200:hover { background-color: #e5e5e5; }
        .light .hover\:bg-dark-300:hover { background-color: #d4d4d4; }
        .light .border-gray-800 { border-color: #d4d4d4; }
        .light .border-gray-700 { border-color: #a3a3a3; }
        .light .text-gray-100 { color: #1f2937; }
        .light .text-gray-300 { color: #374151; }
        .light .text-gray-400 { color: #4b5563; }
        .light .text-gray-500 { color: #6b7280; }
        .light .text-gray-600 { color: #4b5563; }
        .light .text-white { color: #111827; }
        .light .hover\:text-white:hover { color: #111827; }
        .light .bg-gray-800 { background-color: #f0f0f0; }
        .light .bg-gray-800\/50 { background-color: rgba(240, 240, 240, 0.5); }
        .light .hover\:bg-gray-800:hover { background-color: #e5e5e5; }
        .light .hover\:bg-gray-800\/50:hover { background-color: rgba(240, 240, 240, 0.5); }
        .light .bg-gray-700 { background-color: #e5e5e5; }
        .light .hover\:bg-gray-700:hover { background-color: #d4d4d4; }
        .light .bg-gray-950 { background-color: #fafafa; }
        .light .bg-black\/80 { background-color: rgba(0, 0, 0, 0.5); }
        .light .markdown-content { color: #374151; }
        .light .markdown-content code { background-color: #f0f0f0; color: #7c3aed; }
        .light .markdown-content pre { background-color: #f5f5f5; }
        .light .markdown-content strong, .light .markdown-content b { color: #111827; }
        .light .markdown-content h1, .light .markdown-content h2, .light .markdown-content h3, .light .markdown-content h4 { color: #111827; }
        .light .markdown-content a { color: #7c3aed; }
        .light .markdown-content li::marker { color: #6b7280; }
        /* Badge color overrides for Light Mode */
        .light .bg-purple-600\/30 { background-color: rgba(147, 51, 234, 0.25); }
        .light .text-purple-400 { color: #7c3aed; }
        .light .bg-green-600\/20 { background-color: rgba(22, 163, 74, 0.2); }
        .light .text-green-400 { color: #15803d; }
        .light .bg-blue-600\/20 { background-color: rgba(37, 99, 235, 0.2); }
        .light .text-blue-400 { color: #1d4ed8; }
        .light .bg-yellow-600\/20 { background-color: rgba(202, 138, 4, 0.2); }
        .light .text-yellow-400 { color: #a16207; }
        .light .bg-orange-600\/20 { background-color: rgba(234, 88, 12, 0.2); }
        .light .text-orange-400 { color: #c2410c; }
        .light .bg-pink-600\/20 { background-color: rgba(219, 39, 119, 0.2); }
        .light .text-pink-400 { color: #be185d; }
        /* Gradient overrides for Light Mode */
        .light .bg-gradient-to-br.from-dark-100.to-dark-200 {
            background: linear-gradient(to bottom right, #ffffff, #fafafa) !important;
        }
        .light .from-dark-100 { --tw-gradient-from: #ffffff; }
        .light .to-dark-200 { --tw-gradient-to: #fafafa; }
        /* AEra Banner overrides for Light Mode */
        .light .aera-banner {
            background: linear-gradient(to right, rgba(14, 116, 144, 0.15), rgba(37, 99, 235, 0.15)) !important;
            border-color: rgba(14, 116, 144, 0.4) !important;
        }
        .light .aera-title { color: #0e7490 !important; }
        .light .aera-badge { background-color: rgba(14, 116, 144, 0.2) !important; color: #0e7490 !important; }
        .light .aera-subtitle { color: #4b5563 !important; }
        .light .aera-info { color: #6b7280 !important; }
        .light .aera-profile-badge {
            background: linear-gradient(to right, rgba(14, 116, 144, 0.2), rgba(37, 99, 235, 0.2)) !important;
            border-color: rgba(14, 116, 144, 0.5) !important;
            color: #0e7490 !important;
        }
        
        /* Sand Mode */
        .sand body {
            background-color: #f5ebe0;
            color: #44403c;
        }
        .sand .bg-dark-100 { background-color: #faf6f1; }
        .sand .bg-dark-200 { background-color: #f5ebe0; }
        .sand .bg-dark-300 { background-color: #eddfcc; }
        .sand .bg-dark-400 { background-color: #e3d5c3; }
        .sand .bg-dark-400\/80 { background-color: rgba(227, 213, 195, 0.8); }
        .sand .hover\:bg-dark-200:hover { background-color: #d6cbbf; }
        .sand .hover\:bg-dark-300:hover { background-color: #c7b9a8; }
        .sand .border-gray-800 { border-color: #b8a994; }
        .sand .border-gray-700 { border-color: #a89a84; }
        .sand .text-gray-100 { color: #292524; }
        .sand .text-gray-300 { color: #44403c; }
        .sand .text-gray-400 { color: #57534e; }
        .sand .text-gray-500 { color: #78716c; }
        .sand .text-gray-600 { color: #57534e; }
        .sand .text-white { color: #1c1917; }
        .sand .hover\:text-white:hover { color: #1c1917; }
        .sand .bg-gray-800 { background-color: #e7ddd0; }
        .sand .bg-gray-800\/50 { background-color: rgba(231, 221, 208, 0.5); }
        .sand .hover\:bg-gray-800:hover { background-color: #d6cbbf; }
        .sand .hover\:bg-gray-800\/50:hover { background-color: rgba(231, 221, 208, 0.5); }
        .sand .bg-gray-700 { background-color: #d6cbbf; }
        .sand .hover\:bg-gray-700:hover { background-color: #c7b9a8; }
        .sand .bg-gray-950 { background-color: #eddfcc; }
        .sand .bg-black\/80 { background-color: rgba(28, 25, 23, 0.5); }
        .sand .markdown-content { color: #44403c; }
        .sand .markdown-content code { background-color: #e7ddd0; color: #9333ea; }
        .sand .markdown-content pre { background-color: #eddfcc; }
        .sand .markdown-content strong, .sand .markdown-content b { color: #1c1917; }
        .sand .markdown-content h1, .sand .markdown-content h2, .sand .markdown-content h3, .sand .markdown-content h4 { color: #1c1917; }
        .sand .markdown-content a { color: #9333ea; }
        .sand .markdown-content li::marker { color: #78716c; }
        .sand .markdown-content h1, .sand .markdown-content h2, .sand .markdown-content h3 { color: #1c1917; }
        /* Badge color overrides for Sand Mode */
        .sand .bg-purple-600\/30 { background-color: rgba(147, 51, 234, 0.3); }
        .sand .text-purple-400 { color: #7c3aed; }
        .sand .bg-green-600\/20 { background-color: rgba(22, 163, 74, 0.25); }
        .sand .text-green-400 { color: #15803d; }
        .sand .bg-blue-600\/20 { background-color: rgba(37, 99, 235, 0.25); }
        .sand .text-blue-400 { color: #1d4ed8; }
        .sand .bg-yellow-600\/20 { background-color: rgba(202, 138, 4, 0.25); }
        .sand .text-yellow-400 { color: #a16207; }
        .sand .bg-orange-600\/20 { background-color: rgba(234, 88, 12, 0.25); }
        .sand .text-orange-400 { color: #c2410c; }
        .sand .bg-pink-600\/20 { background-color: rgba(219, 39, 119, 0.25); }
        .sand .text-pink-400 { color: #be185d; }
        /* Gradient overrides for Sand Mode */
        .sand .bg-gradient-to-br.from-dark-100.to-dark-200 {
            background: linear-gradient(to bottom right, #faf6f1, #f5ebe0) !important;
        }
        .sand .from-dark-100 { --tw-gradient-from: #faf6f1; }
        .sand .to-dark-200 { --tw-gradient-to: #f5ebe0; }
        /* AEra Banner overrides for Sand Mode */
        .sand .aera-banner {
            background: linear-gradient(to right, rgba(14, 116, 144, 0.18), rgba(37, 99, 235, 0.18)) !important;
            border-color: rgba(14, 116, 144, 0.35) !important;
        }
        .sand .aera-title { color: #0e7490 !important; }
        .sand .aera-badge { background-color: rgba(14, 116, 144, 0.25) !important; color: #0e7490 !important; }
        .sand .aera-subtitle { color: #57534e !important; }
        .sand .aera-info { color: #78716c !important; }
        .sand .aera-profile-badge {
            background: linear-gradient(to right, rgba(14, 116, 144, 0.25), rgba(37, 99, 235, 0.25)) !important;
            border-color: rgba(14, 116, 144, 0.45) !important;
            color: #0e7490 !important;
        }
        
        body {
            background-color: #0a0a14;
        }
        .light body {
            background-color: #f8fafc;
        }
        .sand body {
            background-color: #f5ebe0;
        }
        
        .gradient-border {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.15);
        }
        /* Less rounded corners for frames */
        .rounded-xl {
            border-radius: 0.5rem !important; /* 8px instead of 12px */
        }
        .rounded-2xl {
            border-radius: 0.625rem !important; /* 10px instead of 16px */
        }
        .rounded-3xl {
            border-radius: 0.75rem !important; /* 12px instead of 24px */
        }
        /* Markdown content styles */
        .markdown-content strong, .markdown-content b {
            font-weight: 600;
            color: #fff;
        }
        .markdown-content em, .markdown-content i {
            font-style: italic;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: 700;
            color: #fff;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        .markdown-content h1 { font-size: 1.5rem; }
        .markdown-content h2 { font-size: 1.25rem; }
        .markdown-content h3 { font-size: 1.1rem; }
        .markdown-content ul, .markdown-content ol {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .markdown-content ul { list-style-type: disc; }
        .markdown-content ol { list-style-type: decimal; }
        .markdown-content li { margin-bottom: 0.25rem; }
        .markdown-content code {
            background-color: #1a1a2e;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.9em;
            color: #a78bfa;
        }
        .markdown-content pre {
            background-color: #1a1a2e;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        .markdown-content pre code {
            background: none;
            padding: 0;
        }
        .markdown-content blockquote {
            border-left: 3px solid #a78bfa;
            padding-left: 1rem;
            margin: 0.5rem 0;
            color: #9ca3af;
            font-style: italic;
        }
        .markdown-content a {
            color: #a78bfa;
            text-decoration: underline;
        }
        .markdown-content a:hover {
            color: #c4b5fd;
        }
        .markdown-content p {
            margin-bottom: 0.5rem;
        }
        .markdown-content hr {
            border-color: #374151;
            margin: 1rem 0;
        }
        /* Fix overflow for long text/URLs on mobile */
        .markdown-content {
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            max-width: 100%;
        }
        .markdown-content pre {
            max-width: 100%;
            overflow-x: auto;
        }
        .markdown-content code {
            word-break: break-all;
        }
        .markdown-content a {
            word-break: break-all;
        }
        /* Global overflow fix for issue cards */
        .issue-card, .response-card {
            overflow: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    </style>
    
    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-e1HpaX9gHjZbifp9NIN_P.js"></script>
    <script>
        window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
        plausible.init()
    </script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-dark-400 text-gray-100 min-h-screen">
    {% block content %}{% endblock %}
    
    <!-- Xdest AI Chat Widget -->
    <style>
        /* Chat Button */
        .xdest-chat-button {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 9998;
            padding: 0;
            overflow: hidden;
        }
        .xdest-chat-button:hover {
            transform: scale(1.1);
        }
        .xdest-chat-button img {
            width: 38px;
            height: 38px;
            object-fit: contain;
        }
        
        /* Chat Popup */
        .xdest-chat-popup {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 380px;
            max-width: calc(100vw - 48px);
            height: 520px;
            max-height: calc(100vh - 120px);
            background: linear-gradient(135deg, #0a0a14 0%, #1a1a2e 100%);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
        }
        .xdest-chat-popup.open {
            display: flex;
            animation: xdestSlideUp 0.3s ease;
        }
        @keyframes xdestSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Header */
        .xdest-chat-header {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            padding: 16px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .xdest-chat-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .xdest-chat-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .xdest-chat-close:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Messages */
        .xdest-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
        }
        .xdest-msg {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
            flex-shrink: 0;
        }
        .xdest-msg.user {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .xdest-msg.bot {
            background: #1a1a2e;
            color: #e5e5e5;
            align-self: flex-start;
            margin-right: auto;
            margin-left: 0;
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-bottom-left-radius: 4px;
        }
        .xdest-msg.bot p { margin: 0 0 8px 0; padding: 0; }
        .xdest-msg.bot p:last-child { margin-bottom: 0; }
        .xdest-msg.bot ul, .xdest-msg.bot ol { margin: 8px 0; padding-left: 20px; }
        .xdest-msg.bot li { margin: 4px 0; padding: 0; }
        .xdest-msg.bot strong { color: #c084fc; }
        .xdest-msg.bot code { background: #0a0a14; padding: 2px 6px; border-radius: 4px; font-size: 13px; }
        
        /* Typing indicator */
        .xdest-typing {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: #1a1a2e;
            border-radius: 12px;
            align-self: flex-start;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }
        .xdest-typing span {
            width: 8px;
            height: 8px;
            background: #9333ea;
            border-radius: 50%;
            animation: xdestBounce 1.4s infinite ease-in-out;
        }
        .xdest-typing span:nth-child(1) { animation-delay: 0s; }
        .xdest-typing span:nth-child(2) { animation-delay: 0.2s; }
        .xdest-typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes xdestBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* Input */
        .xdest-chat-input {
            padding: 12px;
            border-top: 1px solid rgba(147, 51, 234, 0.2);
            display: flex;
            gap: 8px;
        }
        .xdest-chat-input input {
            flex: 1;
            background: #0a0a14;
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 8px;
            padding: 10px 14px;
            color: white;
            font-size: 14px;
            outline: none;
        }
        .xdest-chat-input input:focus {
            border-color: #9333ea;
        }
        .xdest-chat-input input::placeholder {
            color: #666;
        }
        .xdest-chat-input button {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .xdest-chat-input button:hover {
            opacity: 0.9;
        }
        .xdest-chat-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
    
    <!-- Chat Button -->
    <button class="xdest-chat-button" onclick="toggleXdestChat()" title="Ask the Xdest AI Assistant">
        <img src="/static/x-logo.png" alt="X" onerror="this.style.display='none';this.parentElement.innerHTML='ðŸ’¬';">
    </button>
    
    <!-- Chat Popup -->
    <div class="xdest-chat-popup" id="xdestChatPopup">
        <div class="xdest-chat-header">
            <h3>Xdest AI Assistant</h3>
            <button class="xdest-chat-close" onclick="toggleXdestChat()">Ã—</button>
        </div>
        <div class="xdest-chat-messages" id="xdestMessages">
            <div class="xdest-msg bot">
                Hi! I'm the Xdest AI Assistant.<br><br>
                I can help you with everything about Xdest â€“ how to sign up, create projects, report issues, and much more.<br><br>
                What would you like to know?
            </div>
        </div>
        <div class="xdest-chat-input">
            <input type="text" id="xdestInput" placeholder="Ask me something..." onkeypress="if(event.key==='Enter')sendXdestMessage()">
            <button onclick="sendXdestMessage()" id="xdestSendBtn">Send</button>
        </div>
    </div>
    
    <script>
        const XDEST_AI_URL = '/ai/api/chat';
        
        function toggleXdestChat() {
            const popup = document.getElementById('xdestChatPopup');
            popup.classList.toggle('open');
            if (popup.classList.contains('open')) {
                document.getElementById('xdestInput').focus();
            }
        }
        
        function addXdestMessage(text, isUser) {
            const container = document.getElementById('xdestMessages');
            const msg = document.createElement('div');
            msg.className = 'xdest-msg ' + (isUser ? 'user' : 'bot');
            
            if (!isUser) {
                // Parse markdown-like formatting
                text = text
                    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:#a855f7;text-decoration:underline;">$1</a>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n\n/g, '<br><br>')
                    .replace(/\n/g, '<br>');
            }
            
            msg.innerHTML = text;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            return msg;
        }
        
        function showTyping() {
            const container = document.getElementById('xdestMessages');
            const typing = document.createElement('div');
            typing.className = 'xdest-typing';
            typing.id = 'xdestTyping';
            typing.innerHTML = '<span></span><span></span><span></span>';
            container.appendChild(typing);
            container.scrollTop = container.scrollHeight;
        }
        
        function hideTyping() {
            const typing = document.getElementById('xdestTyping');
            if (typing) typing.remove();
        }
        
        async function sendXdestMessage() {
            const input = document.getElementById('xdestInput');
            const btn = document.getElementById('xdestSendBtn');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.value = '';
            btn.disabled = true;
            
            addXdestMessage(message, true);
            showTyping();
            
            try {
                const response = await fetch(XDEST_AI_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        context: window.location.pathname
                    })
                });
                
                hideTyping();
                
                if (response.ok) {
                    const data = await response.json();
                    addXdestMessage(data.response, false);
                } else {
                    addXdestMessage('Sorry, I am currently unavailable. Please try again later.', false);
                }
            } catch (error) {
                hideTyping();
                addXdestMessage('Connection error. Please check your internet connection.', false);
            }
            
            btn.disabled = false;
            input.focus();
        }
    </script>
    
    <!-- Markdown Rendering -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configure marked for security
            if (typeof marked !== 'undefined') {
                marked.setOptions({
                    breaks: true,  // Convert \n to <br>
                    gfm: true,     // GitHub Flavored Markdown
                    sanitize: false
                });
                
                // Render all markdown content
                document.querySelectorAll('.markdown-content').forEach(function(el) {
                    const rawText = el.getAttribute('data-markdown') || el.textContent;
                    el.innerHTML = marked.parse(rawText);
                });
            }
        });
        
        // Function to render markdown dynamically (for AJAX content)
        function renderMarkdown(element) {
            if (typeof marked !== 'undefined' && element) {
                const rawText = element.getAttribute('data-markdown') || element.textContent;
                element.innerHTML = marked.parse(rawText);
            }
        }
    </script>
    
    <!-- Theme Toggle Script -->
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const themes = ['dark', 'light', 'sand'];
            let currentTheme = 'dark';
            
            // Find current theme
            for (const theme of themes) {
                if (html.classList.contains(theme)) {
                    currentTheme = theme;
                    break;
                }
            }
            
            // Get next theme in cycle: dark â†’ light â†’ sand â†’ dark
            const currentIndex = themes.indexOf(currentTheme);
            const newTheme = themes[(currentIndex + 1) % themes.length];
            
            // Remove all theme classes and add new one
            themes.forEach(t => html.classList.remove(t));
            html.classList.add(newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update theme color meta tag
            const themeColorMeta = document.getElementById('theme-color-meta');
            if (themeColorMeta) {
                const colors = { dark: '#0a0a14', light: '#f8fafc', sand: '#f5ebe0' };
                themeColorMeta.content = colors[newTheme];
            }
            
            // Update all theme toggle icons
            updateThemeIcons(newTheme);
        }
        
        function updateThemeIcons(theme) {
            // Sun icon - shown in dark mode (click for light)
            document.querySelectorAll('.theme-icon-sun').forEach(el => {
                el.classList.toggle('hidden', theme !== 'dark');
            });
            // Moon icon - shown in light mode (click for sand)
            document.querySelectorAll('.theme-icon-moon').forEach(el => {
                el.classList.toggle('hidden', theme !== 'light');
            });
            // Sand icon - shown in sand mode (click for dark)
            document.querySelectorAll('.theme-icon-sand').forEach(el => {
                el.classList.toggle('hidden', theme !== 'sand');
            });
        }
        
        // Initialize icons on page load
        document.addEventListener('DOMContentLoaded', function() {
            const html = document.documentElement;
            let currentTheme = 'dark';
            if (html.classList.contains('light')) currentTheme = 'light';
            else if (html.classList.contains('sand')) currentTheme = 'sand';
            updateThemeIcons(currentTheme);
        });
        
        // Logo Size Logger
        (function() {
            let logoSizes = {};
            
            function logLogoSize(logo, event) {
                const id = logo.id || logo.src || 'unknown';
                const newSize = { width: logo.offsetWidth, height: logo.offsetHeight };
                const oldSize = logoSizes[id];
                
                if (oldSize && (oldSize.width !== newSize.width || oldSize.height !== newSize.height)) {
                    const logData = {
                        event: event,
                        page: window.location.pathname,
                        logoSrc: logo.src,
                        oldSize: oldSize,
                        newSize: newSize,
                        timestamp: new Date().toISOString(),
                        viewport: { width: window.innerWidth, height: window.innerHeight }
                    };
                    
                    console.log('[LOGO SIZE CHANGE]', logData);
                    
                    // Send to server
                    fetch('/api/log/logo-size', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(logData)
                    }).catch(() => {}); // Silent fail
                }
                
                logoSizes[id] = newSize;
            }
            
            function initLogoLogger() {
                const logos = document.querySelectorAll('img[alt="Xdest"], img[src*="logo"], img[src*="Logo"], img[src*="IMG_5015"]');
                
                logos.forEach((logo, index) => {
                    logo.id = logo.id || `logo-${index}`;
                    
                    // Initial size
                    if (logo.complete) {
                        logLogoSize(logo, 'initial');
                    } else {
                        logo.addEventListener('load', () => logLogoSize(logo, 'load'));
                    }
                });
                
                // Watch for resize
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        logos.forEach(logo => logLogoSize(logo, 'resize'));
                    }, 100);
                });
                
                // Watch for CSS class changes (responsive breakpoints)
                if (window.ResizeObserver) {
                    logos.forEach(logo => {
                        new ResizeObserver(() => logLogoSize(logo, 'observer')).observe(logo);
                    });
                }
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initLogoLogger);
            } else {
                initLogoLogger();
            }
        })();
    </script>
</body>
</html>
